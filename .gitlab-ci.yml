image: gitlab.svagworks.me:5050/root/demo_2

variables:
    PATH_TO_JAR: /target/*.jar

before_script:
    - 'which ssh-agent || ( apt update -y && apt install openssh-client -y)'
    - eval $(ssh-agent -s)
    - ssh-add <(echo "$SSH_PRIVATE_KEY")
    - mkdir -p ~/.ssh
    - '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config'

stages:
    - build
    - deploy

.build_template:
    stage: build
    script:
        - cd $PATH_TO_APP
        - mvn clean package 
     artifacts:
        paths:
            - $PATH_TO_APP$PATH_TO_JAR
        expire_in: 1 day

build_billing:
    <<: *build_template
    variables:
        - PATH_TO_APP: BE/BillingService


#build_2:
#    stage: build
#    script:
#      - cd BE/CustomerService/customers
#      - mvn clean package 
#    artifacts:
#      paths:
#      - BE/CustomerService/customers/target/*.jar
#      expire_in: 1 day

#build_3:
#    stage: build
#    script:
#      - cd BE/Gateway
#      - mvn clean package 
#    artifacts:
#      paths:
#      - BE/Gateway/target/*.jar
#      expire_in: 1 day

#build_4:
#    stage: build
#    script:
#      - cd BE/GoogleMapsMicroservice
#      - mvn clean package 
#    artifacts:
#      paths:
#      - BE/GoogleMapsMicroservice/target/*.jar
#      expire_in: 1 day

#build_5:
#    stage: build
#    script:
#      - cd BE/OrderService
#      - mvn clean package 
#    artifacts:
#      paths:
#      - BE/OrderService/target/*.jar
#      expire_in: 1 day

#build_6:
#    stage: build
#    script:
#      - cd BE/ServiceDiscovery
#      - mvn clean package 
#    artifacts:
#      paths:
#      - BE/ServiceDiscovery/target/*.jar
#      expire_in: 1 day
      
#build_7:
#    stage: build
#    script:
#      - cd BE/ServiceProvider
#      - mvn clean package 
#    artifacts:
#      paths:
#      - BE/ServiceProvider/target/*.jar
#      expire_in: 1 day
      
deploy:
    stage: deploy
    script:
      - scp BE/BillingService/target/*.jar $UN_IP:/tmp
      #- scp BE/CustomerService/customers/target/*.jar $UN_IP:/tmp
      #- scp BE/Gateway/target/*.jar $UN_IP:/tmp
      #- scp deploy.sh $UN_IP:/tmp
      #- scp BE/GoogleMapsMicroservice/target/*.jar $UN_IP:/tmp
      #- scp BE/OrderService/target/*.jar $UN_IP:/tmp
      #- scp BE/ServiceDiscovery/target/*.jar $UN_IP:/tmp
      #- scp BE/ServiceProvider/target/*.jar $UN_IP:/tmp
      #- ssh $UN_IP "cd /tmp && sudo bash deploy.sh "

