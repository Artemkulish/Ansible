image: gitlab.svagworks.me:5050/root/ansible

before_script:
    - 'which ssh-agent || ( apt update -y && apt install openssh-client -y)'
    - eval $(ssh-agent -s)
    - ssh-add <(echo "$SSH_PRIVATE_KEY")
    - mkdir -p ~/.ssh
    - '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config'
    
build:
  script:
    - ls
    - cat hosts
    - ansible --version
    #- apt update
    #- apt upgrade -y
    #- curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
    #- python get-pip.py
    #- pip install boto boto3 netaddr passlib
    - ansible -m ping all -i hosts
    - sudo ansible-playbook -i hosts postgresql.yml
