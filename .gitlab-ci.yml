stages:
    - ansible
    - monitoring

.ansible_template: &ansible_template
    stage: ansible
    script:
        - ansible-playbook demo3/$PLAYBOOK --vault-password-file /home/pass/db_pass
    when: manual
    
#conteiner-opimized:
#    <<: *ansible_template
#    variables:
#        PLAYBOOK: create_conteiner-opt.yml
#    only:
#        changes:
#            - demo3/create_conteiner-opt.yml

pingdom:
    stage: monitoring
    script:
        - cat ./demo3/pingdom.py | sed -e "s/hidden/$PINGDOM_TOKEN/" > ./demo3/pingdom_with_token.py
        - cat ./demo3/pingdom_with_token.py
        - python ./demo3/pingdom_with_token.py
    when: manual
    #only:
    #    changes:
    #        - demo3/create_conteiner-opt.yml
            
cloud-sql:
    <<: *ansible_template
    variables:
        PLAYBOOK: cloudsql.yml
    only:
        changes:
            - demo3/cloudsql.yml          

load-balancer:
    <<: *ansible_template
    variables:
        PLAYBOOK: loadbalancer.yml
    only:
        changes:
            - demo3/loadbalancer.yml  
